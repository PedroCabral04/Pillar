@page "/"
@attribute [Authorize]
@using Microsoft.AspNetCore.Components.Authorization
@using MudBlazor
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager

<PageTitle>Início - Pillar ERP</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    @if (_isLoading)
    {
        <MudProgressLinear Color="MudBlazor.Color.Primary" Indeterminate="true" />
    }
    else
    {
        <!-- Seção de Boas-vindas -->
        <MudPaper Elevation="0" Class="pa-6 mb-4" Style="background: linear-gradient(135deg, var(--mud-palette-primary) 0%, var(--mud-palette-primary-darken) 100%);">
            <MudGrid>
                <MudItem xs="12" md="8">
                    <MudText Typo="Typo.h3" Style="color: white; font-weight: 600;" Class="mb-2">
                        Olá, @_userName!
                    </MudText>
                    <MudText Typo="Typo.h6" Style="color: rgba(255,255,255,0.9);">
                        Bem-vindo ao Pillar ERP - Seu sistema de gestão empresarial
                    </MudText>
                </MudItem>
                <MudItem xs="12" md="4" Class="d-flex align-center justify-end">
                    <MudText Typo="Typo.h4" Style="color: white;">
                        @DateTime.Now.ToString("dd/MM/yyyy")
                    </MudText>
                </MudItem>
            </MudGrid>
        </MudPaper>

        <!-- Cards de Acesso Rápido -->
        <MudText Typo="Typo.h5" Class="mb-3 mt-6">Acesso Rápido</MudText>
        <MudGrid>
            <!-- Dashboard -->
            <MudItem xs="12" sm="6" md="4">
                <MudCard Elevation="2" Class="cursor-pointer hover-card" @onclick="@(() => NavigateTo("/dashboard"))">
                    <MudCardContent Class="pa-6">
                        <div class="d-flex align-center mb-3">
                            <MudIcon Icon="@Icons.Material.Filled.Dashboard" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Primary" Class="mr-3" />
                            <MudText Typo="Typo.h6">Dashboard</MudText>
                        </div>
                        <MudText Typo="Typo.body2" Color="MudBlazor.Color.Secondary">
                            Visualize métricas e indicadores do seu negócio em tempo real
                        </MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>

            <!-- Kanban -->
            <MudItem xs="12" sm="6" md="4">
                <MudCard Elevation="2" Class="cursor-pointer hover-card" @onclick="@(() => NavigateTo("/kanban"))">
                    <MudCardContent Class="pa-6">
                        <div class="d-flex align-center mb-3">
                            <MudIcon Icon="@Icons.Material.Filled.ViewKanban" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Success" Class="mr-3" />
                            <MudText Typo="Typo.h6">Kanban</MudText>
                        </div>
                        <MudText Typo="Typo.body2" Color="MudBlazor.Color.Secondary">
                            Organize suas tarefas e projetos de forma visual e colaborativa
                        </MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>

            <!-- Administração -->
            @if (_isAdmin)
            {
                <MudItem xs="12" sm="6" md="4">
                    <MudCard Elevation="2" Class="cursor-pointer hover-card" @onclick="@(() => NavigateTo("/admin/users"))">
                        <MudCardContent Class="pa-6">
                            <div class="d-flex align-center mb-3">
                                <MudIcon Icon="@Icons.Material.Filled.AdminPanelSettings" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Warning" Class="mr-3" />
                                <MudText Typo="Typo.h6">Administração</MudText>
                            </div>
                            <MudText Typo="Typo.body2" Color="MudBlazor.Color.Secondary">
                                Gerencie usuários, permissões e configurações do sistema
                            </MudText>
                        </MudCardContent>
                    </MudCard>
                </MudItem>
            }

            <!-- Configurações -->
            <MudItem xs="12" sm="6" md="4">
                <MudCard Elevation="2" Class="cursor-pointer hover-card" @onclick="@(() => NavigateTo("/settings"))">
                    <MudCardContent Class="pa-6">
                        <div class="d-flex align-center mb-3">
                            <MudIcon Icon="@Icons.Material.Filled.Settings" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Info" Class="mr-3" />
                            <MudText Typo="Typo.h6">Configurações</MudText>
                        </div>
                        <MudText Typo="Typo.body2" Color="MudBlazor.Color.Secondary">
                            Personalize sua experiência e ajuste suas preferências
                        </MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Dica do Dia -->
        <MudPaper Elevation="0" Class="pa-4 mt-6" Style="border-left: 4px solid var(--mud-palette-primary);">
            <div class="d-flex align-start">
                <MudIcon Icon="@Icons.Material.Filled.Lightbulb" Color="MudBlazor.Color.Primary" Class="mr-3 mt-1" />
                <div>
                    <MudText Typo="Typo.h6" Class="mb-2">💡 Dica do Dia</MudText>
                    <MudText Typo="Typo.body2">
                        Você sabia que pode personalizar completamente o seu dashboard? 
                        Acesse <MudLink Href="/dashboard">Dashboard</MudLink> e clique em "Personalizar" para adicionar, 
                        remover ou reorganizar widgets de acordo com suas necessidades.
                    </MudText>
                </div>
            </div>
        </MudPaper>
    }
</MudContainer>

<style>
    .hover-card {
        transition: all 0.3s ease;
    }

    .hover-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15) !important;
    }

    .cursor-pointer {
        cursor: pointer;
    }
</style>

@code {
    private bool _isLoading = true;
    private string _userName = "";
    private bool _isAdmin = false;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
            var user = authState.User;

            if (user.Identity?.IsAuthenticated == true)
            {
                _userName = user.Identity.Name ?? "Usuário";
                _isAdmin = user.IsInRole("Admin");
            }
        }
        catch (Exception)
        {
            _userName = "Usuário";
        }
        finally
        {
            _isLoading = false;
        }
    }

    private void NavigateTo(string url)
    {
        NavigationManager.NavigateTo(url);
    }
}