@using MudBlazor
@inject NavigationManager Navigation
@implements IDisposable

<nav class="mobile-bottom-nav" role="navigation" aria-label="Navegação principal">
    <a href="/" class="bottom-nav-item @GetActiveClass("/")" @onclick="@(() => NavigateTo("/"))" @onclick:preventDefault>
        <MudIcon Icon="@Icons.Material.Filled.Home" Class="bottom-nav-item__icon" />
        <span class="bottom-nav-item__label">Inicio</span>
    </a>

    <a href="/dashboard" class="bottom-nav-item @GetActiveClass("/dashboard")" @onclick="@(() => NavigateTo("/dashboard"))" @onclick:preventDefault>
        <MudIcon Icon="@Icons.Material.Filled.Dashboard" Class="bottom-nav-item__icon" />
        <span class="bottom-nav-item__label">Dashboard</span>
    </a>

    <a href="/sales" class="bottom-nav-item @GetActiveClass("/sales")" @onclick="@(() => NavigateTo("/sales"))" @onclick:preventDefault>
        <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" Class="bottom-nav-item__icon" />
        <span class="bottom-nav-item__label">Vendas</span>
    </a>

    <a href="/inventory/products" class="bottom-nav-item @GetActiveClass("/inventory")" @onclick="@(() => NavigateTo("/inventory/products"))" @onclick:preventDefault>
        <MudIcon Icon="@Icons.Material.Filled.Inventory" Class="bottom-nav-item__icon" />
        <span class="bottom-nav-item__label">Estoque</span>
    </a>

    <a href="/financial/dashboard" class="bottom-nav-item @GetActiveClass("/financial")" @onclick="@(() => NavigateTo("/financial/dashboard"))" @onclick:preventDefault>
        <MudIcon Icon="@Icons.Material.Filled.AccountBalance" Class="bottom-nav-item__icon" />
        <span class="bottom-nav-item__label">Financeiro</span>
    </a>
</nav>

@code {
    private string _currentPath = string.Empty;

    protected override void OnInitialized()
    {
        _currentPath = Navigation.ToBaseRelativePath(Navigation.Uri);
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs args)
    {
        _currentPath = Navigation.ToBaseRelativePath(args.Location);
        StateHasChanged();
    }

    private string GetActiveClass(string path)
    {
        var currentPath = _currentPath.TrimStart('/');
        var targetPath = path.TrimStart('/');

        if (string.IsNullOrEmpty(targetPath))
        {
            return string.IsNullOrEmpty(currentPath) ? "active" : string.Empty;
        }

        return currentPath.StartsWith(targetPath, StringComparison.OrdinalIgnoreCase) ? "active" : string.Empty;
    }

    private void NavigateTo(string path)
    {
        Navigation.NavigateTo(path);
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}
